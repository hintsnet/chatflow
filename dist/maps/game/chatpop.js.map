{"version":3,"sources":["game/chatpop.coffee"],"names":[],"mappings":"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","file":"game/chatpop.js","sourceRoot":"/source/","sourcesContent":["# 对话泡泡\r\n\r\n# 用法\r\n# pop = new ChatPop($panel, npc)\r\n# pop.append(str1, callback)\r\n# pop.append(str2, callback)\r\n# pop.remove()\r\n\r\n# 旁白对话\r\n# pop = new ChatPop($panel)\r\n\r\n# 显示等待提示\r\n# pop.wait(callback)\r\n\r\nwindow.ChatPop = class ChatPop\r\n  constructor: (@$panel, @npc)->\r\n    @$chatpop = buildel 'div.chatpop'\r\n      .css\r\n        'opacity': 0\r\n        'top': 30\r\n      .animate\r\n        'opacity': 1\r\n        'top': 0\r\n      , 500\r\n      .appendTo @$panel\r\n\r\n    if @npc?\r\n      @$npc_avatar = buildel 'img.avatar'\r\n        .attr 'src', npc.avatar\r\n        .appendTo @$chatpop\r\n    else\r\n      @$chatpop.addClass 'no-npc'\r\n\r\n    @$area = buildel 'div.area'\r\n      .appendTo @$chatpop\r\n\r\n    @$pop = buildel 'div.pop'\r\n      .appendTo @$area\r\n\r\n    if @npc?\r\n      @$npc_name = buildel 'div.name'\r\n        .html @npc.name + \":\"\r\n        .appendTo @$pop\r\n\r\n  text: (string, callback, config={})->\r\n    if config.link?\r\n      $text = buildel 'a.text.link'\r\n        .attr 'href', config.link\r\n        .attr 'target', '_blank'\r\n        .appendTo @$pop\r\n        .on 'click', (evt)->\r\n          evt.stopPropagation()\r\n    else\r\n      $text = buildel 'span.text'\r\n        .appendTo @$pop\r\n\r\n    # 样式\r\n    if config.style?\r\n      $text.css config.style\r\n\r\n    # 换行或不换行\r\n    if config.linebreak is true\r\n      $text.typing_string string, config.speed, callback\r\n    else\r\n      $text.typing_string_nobr string, config.speed, callback\r\n\r\n  image: (image, callback, config={})->\r\n    $image = buildel 'img.img'\r\n      .attr 'src', image\r\n      .hide()\r\n      .fadeIn()\r\n      .appendTo @$pop\r\n\r\n    # 样式\r\n    if config.style?\r\n      $image.css config.style\r\n\r\n    callback()\r\n\r\n  append: (sentence)->\r\n    callback_holder = new CallbackHolder\r\n    finish = ->\r\n      callback_holder.do 'appended'\r\n\r\n    if sentence.delay is -1\r\n      textdone = =>\r\n        @wait finish\r\n    else\r\n      textdone = ->\r\n        setTimeout finish, sentence.delay\r\n\r\n    if sentence.image?\r\n      @image sentence.image, textdone, {\r\n        style: sentence.style\r\n      }\r\n    else\r\n      @text sentence.text, textdone, {\r\n        linebreak: sentence.linebreak\r\n        style: sentence.style\r\n        link: sentence.link\r\n        speed: sentence.speed\r\n      }\r\n\r\n    return callback_holder\r\n\r\n  wait: (callback)->\r\n    $wait = buildel 'div.click-to-continue'\r\n      .append buildel('span').html('点击屏幕任意位置继续')\r\n      .hide().fadeIn 100\r\n      .appendTo @$area\r\n\r\n    jQuery(document).one 'click', ->\r\n      $wait.remove()\r\n      callback()\r\n\r\n  remove: (callback)->\r\n    @$chatpop\r\n      .animate\r\n        'opacity': 0\r\n      , 200, =>\r\n        @$chatpop.remove()\r\n        callback() if callback\r\n\r\n\r\n  # 执行一系列子句\r\n  # 全部执行完毕后，调用回调方法\r\n  sentences: (sentences_data)->\r\n    callback_holder = new CallbackHolder\r\n    finish = ->\r\n      callback_holder.do 'finish'\r\n\r\n    @_sentences sentences_data, 0, finish\r\n\r\n    return callback_holder\r\n\r\n  _sentences: (data, idx, callback)->\r\n    if idx < data.length\r\n      gamelog \"[chatpop][sentence] ##{idx}\"\r\n      sentence = new ChatSentence data[idx]\r\n      @append(sentence).on 'appended', =>\r\n        @_sentences data, idx + 1, callback\r\n      return\r\n\r\n    gamelog '[chatpop] sentences finished'\r\n    # @remove -> callback()\r\n    callback()"]}