{"version":3,"sources":["game/game.coffee"],"names":[],"mappings":"AACA;AAAA,MAAA,IAAA;;AAAA,EAAA,MAAM,CAAC,IAAP,GAAoB;AACL,IAAA,cAAE,IAAF,GAAA;AACX,MADY,IAAC,CAAA,OAAA,IACb,CAAA;AAAA,MAAA,IAAC,CAAA,OAAD,GAAW,IAAC,CAAA,IAAI,CAAC,OAAjB,CAAA;AAAA,MACA,IAAC,CAAA,SAAD,CAAA,CADA,CAAA;AAAA,MAIA,IAAC,CAAA,KAAD,GAAS,EAJT,CAAA;AAAA,MAMA,IAAC,CAAA,IAAD,CAAA,CANA,CAAA;AAAA,MAOA,IAAC,CAAA,KAAD,CAAA,CAPA,CADW;IAAA,CAAb;;AAAA,mBAUA,IAAA,GAAM,SAAC,GAAD,EAAM,KAAN,GAAA;AACJ,MAAA,IAAG,aAAH;AACE,QAAA,IAAC,CAAA,KAAM,CAAA,GAAA,CAAP,GAAc,KAAd,CAAA;AACA,eAAO,IAAP,CAFF;OAAA;AAIA,aAAO,IAAC,CAAA,KAAM,CAAA,GAAA,CAAd,CALI;IAAA,CAVN,CAAA;;AAAA,mBAiBA,SAAA,GAAW,SAAA,GAAA;AACT,UAAA,kCAAA;AAAA,MAAA,IAAC,CAAA,IAAD,GAAQ,EAAR,CAAA;AACA;AAAA;WAAA,2CAAA;4BAAA;AACE,sBAAA,IAAC,CAAA,IAAK,CAAA,QAAQ,CAAC,EAAT,CAAN,GAAyB,IAAA,GAAA,CAAI,QAAJ,EAAzB,CADF;AAAA;sBAFS;IAAA,CAjBX,CAAA;;AAAA,mBAsBA,OAAA,GAAS,SAAC,EAAD,GAAA;aACP,IAAC,CAAA,IAAK,CAAA,EAAA,EADC;IAAA,CAtBT,CAAA;;AAAA,mBAyBA,IAAA,GAAM,SAAA,GAAA;aACJ,IAAC,CAAA,MAAD,GAAc,IAAA,YAAA,CAAa,IAAb,EADV;IAAA,CAzBN,CAAA;;AAAA,mBA4BA,KAAA,GAAO,SAAA,GAAA;AACL,MAAA,IAAC,CAAA,GAAD,GAAO,CAAP,CAAA;aACA,IAAC,CAAA,QAAD,CAAA,EAFK;IAAA,CA5BP,CAAA;;AAAA,mBAiCA,QAAA,GAAU,SAAA,GAAA;AACR,MAAA,IAAG,IAAC,CAAA,GAAD,GAAO,IAAC,CAAA,OAAO,CAAC,MAAnB;AACE,QAAA,OAAA,CAAS,qBAAA,GAAqB,IAAC,CAAA,GAA/B,CAAA,CAAA;eACA,IAAC,CAAA,MACC,CAAC,GADH,CACO,IAAC,CAAA,OAAQ,CAAA,IAAC,CAAA,GAAD,CADhB,CAEE,CAAC,EAFH,CAEM,QAFN,EAEgB,CAAA,SAAA,KAAA,GAAA;iBAAA,SAAA,GAAA;AACZ,YAAA,OAAA,CAAQ,0BAAR,CAAA,CAAA;AAAA,YACA,OAAA,CAAQ,EAAR,CADA,CAAA;AAAA,YAEA,KAAC,CAAA,GAAD,EAFA,CAAA;mBAGA,KAAC,CAAA,QAAD,CAAA,EAJY;UAAA,EAAA;QAAA,CAAA,CAAA,CAAA,IAAA,CAFhB,EAFF;OAAA,MAAA;eAWE,OAAA,CAAQ,QAAR,EAXF;OADQ;IAAA,CAjCV,CAAA;;gBAAA;;MADF,CAAA;AAAA","file":"game/game.js","sourceRoot":"/source/","sourcesContent":["# 游戏脚本解析器\r\nwindow.Game = class Game\r\n  constructor: (@data)->\r\n    @scripts = @data.scripts\r\n    @load_npcs()\r\n\r\n    # 初始化一些过程变量信息\r\n    @_vars = {}\r\n\r\n    @init()\r\n    @start()\r\n\r\n  vars: (key, value)->\r\n    if value?\r\n      @_vars[key] = value\r\n      return @\r\n\r\n    return @_vars[key]\r\n\r\n  load_npcs: ->\r\n    @npcs = {}\r\n    for npc_data in @data.npcs\r\n      @npcs[npc_data.id] = new NPC npc_data\r\n\r\n  get_npc: (id)->\r\n    @npcs[id]\r\n\r\n  init: ->\r\n    @runner = new ScriptRunner @\r\n\r\n  start: ->\r\n    @idx = 0\r\n    @run_next()\r\n\r\n  # 执行下一条脚本\r\n  run_next: ->\r\n    if @idx < @scripts.length\r\n      gamelog \"[game] run script ##{@idx}\"\r\n      @runner\r\n        .run @scripts[@idx]\r\n        .on 'finish', =>\r\n          gamelog '[game] a script finished'\r\n          gamelog ''\r\n          @idx++\r\n          @run_next()\r\n\r\n    else\r\n      gamelog '脚本运行结束'"]}