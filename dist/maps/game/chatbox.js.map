{"version":3,"sources":["game/chatbox.coffee"],"names":[],"mappings":"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","file":"game/chatbox.js","sourceRoot":"/source/","sourcesContent":["# 对话面板\r\nwindow.ChatBox = class ChatBox\r\n  constructor: (@game)->\r\n    @$chatbox = jQuery('.panel.chatbox')\r\n    @pops = []\r\n\r\n    @bind_events()\r\n\r\n  # 清除所有泡泡，再调用回调方法\r\n  clear: (callback)->\r\n    _clear_count = @pops.length\r\n    return callback() if _clear_count is 0\r\n\r\n    for pop in @pops\r\n      pop.remove ->\r\n        _clear_count--\r\n        callback() if _clear_count is 0\r\n\r\n  # 显示对话脚本\r\n  # 对话脚本可能包括 NPC 头像\r\n  # 依次显示所有子句\r\n  # 当子句全部显示完毕后，执行回调\r\n  show_sentences: (script, callback)->\r\n    callback_holder = new CallbackHolder\r\n    finish = ->\r\n      callback_holder.do 'finish'\r\n\r\n    gamelog '[chatbox] show SENTENCES'\r\n\r\n    npc =  @game.get_npc script.npc if script.npc\r\n\r\n    chatpop = new ChatPop @$chatbox, npc\r\n    chatpop\r\n      .sentences script.sentences\r\n      .on 'finish', ->\r\n        finish()\r\n\r\n    @pops.push chatpop\r\n\r\n    return callback_holder\r\n\r\n  # 显示提问框\r\n  show_question: (script, callback)->\r\n    callback_holder = new CallbackHolder\r\n    finish = ->\r\n      callback_holder.do 'finish'\r\n\r\n    questionpop = new QuestionPop @$chatbox\r\n    questionpop.show script, (result)=>\r\n      gamelog '[chatbox] user selected: ' + result\r\n      @game.vars script.select, {\r\n        'items': script.items\r\n        'selected': result\r\n      }\r\n      finish()\r\n\r\n    @pops.push questionpop\r\n\r\n    return callback_holder\r\n\r\n  # # 显示 html 片断\r\n  # show_html: (script, callback)->\r\n  #   htmlpop = new HTMLPop @$chatbox\r\n  #   htmlpop.show script, ->\r\n  #     htmlpop.remove()\r\n  #     callback()\r\n\r\n  bind_events: ->\r\n    jQuery(document).on 'chatflow.content-changed', =>\r\n      height = @$chatbox.height()\r\n      window_height = jQuery(window).height()\r\n\r\n      # console.log height, window_height\r\n      if height > window_height\r\n        jQuery(window).scrollTop height - window_height"]}