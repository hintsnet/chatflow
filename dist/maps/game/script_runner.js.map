{"version":3,"sources":["game/script_runner.coffee"],"names":[],"mappings":"AACA;AAAA,MAAA,YAAA;;AAAA,EAAA,MAAM,CAAC,YAAP,GAA4B;AACb,IAAA,sBAAE,IAAF,GAAA;AACX,MADY,IAAC,CAAA,OAAA,IACb,CAAA;AAAA,MAAA,IAAC,CAAA,OAAD,GAAe,IAAA,OAAA,CAAQ,IAAC,CAAA,IAAT,CAAf,CADW;IAAA,CAAb;;AAAA,2BAGA,GAAA,GAAK,SAAC,MAAD,GAAA;AACH,UAAA,6BAAA;AAAA,MAAA,eAAA,GAAkB,GAAA,CAAA,cAAlB,CAAA;AAAA,MACA,MAAA,GAAS,SAAA,GAAA;eACP,eAAe,CAAC,IAAD,CAAf,CAAmB,QAAnB,EADO;MAAA,CADT,CAAA;AAAA,MAIA,IAAA,GAAO,CAAA,SAAA,KAAA,GAAA;eAAA,SAAA,GAAA;AAEL,cAAA,4CAAA;AAAA,UAAA,IAAG,MAAM,CAAC,SAAV;AACE,YAAA,OAAA,CAAQ,2BAAR,CAAA,CAAA;AAAA,YACA,KAAC,CAAA,OACC,CAAC,cADH,CACkB,MADlB,CAEE,CAAC,EAFH,CAEM,QAFN,EAEgB,SAAA,GAAA;AACZ,cAAA,OAAA,CAAQ,6BAAR,CAAA,CAAA;qBACA,MAAA,CAAA,EAFY;YAAA,CAFhB,CADA,CADF;WAAA;AAQA,UAAA,IAAG,MAAM,CAAC,MAAV;AACE,YAAA,OAAA,CAAQ,wBAAR,CAAA,CAAA;AAAA,YACA,KAAC,CAAA,OACC,CAAC,aADH,CACiB,MADjB,CAEE,CAAC,EAFH,CAEM,QAFN,EAEgB,SAAA,GAAA;AACZ,cAAA,OAAA,CAAQ,0BAAR,CAAA,CAAA;qBACA,MAAA,CAAA,EAFY;YAAA,CAFhB,CADA,CADF;WARA;AAgBA,UAAA,IAAG,MAAM,CAAC,QAAV;AACE,YAAA,YAAA,GAAe,KAAC,CAAA,IAAI,CAAC,IAAN,CAAW,MAAM,CAAC,QAAlB,CAA2B,CAAC,QAA3C,CAAA;AAAA,YACA,aAAA,GAAgB,KAAC,CAAA,IAAI,CAAC,IAAN,CAAW,MAAM,CAAC,QAAlB,CAA2B,CAAC,KAAM,CAAA,YAAA,CADlD,CAAA;AAAA,YAGA,OAAA,CAAQ,4BAAA,GAA+B,YAA/B,GAA8C,IAA9C,GAAqD,aAA7D,CAHA,CAAA;AAAA,YAIA,eAAA,GAAkB,MAAM,CAAC,QAAS,CAAA,YAAA,CAJlC,CAAA;mBAKA,KAAC,CAAA,GAAD,CAAK,eAAL,CAAqB,CAAC,EAAtB,CAAyB,QAAzB,EAAmC,MAAnC,EANF;WAlBK;QAAA,EAAA;MAAA,CAAA,CAAA,CAAA,IAAA,CAJP,CAAA;;QA8BA,MAAM,CAAC,QAAS;OA9BhB;AA+BA,MAAA,IAAG,MAAM,CAAC,KAAV;AACE,QAAA,IAAC,CAAA,OAAO,CAAC,KAAT,CAAe,IAAf,CAAA,CADF;OAAA,MAAA;AAGE,QAAA,IAAA,CAAA,CAAA,CAHF;OA/BA;AAoCA,aAAO,eAAP,CArCG;IAAA,CAHL,CAAA;;wBAAA;;MADF,CAAA;AAAA","file":"game/script_runner.js","sourceRoot":"/source/","sourcesContent":["# 判断脚本类型，并调用对应的执行方法\r\nwindow.ScriptRunner = class ScriptRunner\r\n  constructor: (@game)->\r\n    @chatbox = new ChatBox @game\r\n\r\n  run: (script)->\r\n    callback_holder = new CallbackHolder\r\n    finish = ->\r\n      callback_holder.do 'finish'\r\n\r\n    _run = =>\r\n      # sentences\r\n      if script.sentences\r\n        gamelog '[runner] script SENTENCES'\r\n        @chatbox\r\n          .show_sentences script\r\n          .on 'finish', =>\r\n            gamelog '[runner] SENTENCES finished'\r\n            finish()\r\n\r\n      if script.select\r\n        gamelog '[runner] script SELECT'\r\n        @chatbox\r\n          .show_question script\r\n          .on 'finish', =>\r\n            gamelog '[runner] SELECT finished'\r\n            finish()\r\n\r\n      if script.selected\r\n        selected_idx = @game.vars(script.selected).selected\r\n        selected_text = @game.vars(script.selected).items[selected_idx]\r\n\r\n        gamelog '[runner] script SELECTED: ' + selected_idx + ', ' + selected_text\r\n        selected_script = script.response[selected_idx]\r\n        @run(selected_script).on 'finish', finish\r\n\r\n    script.clear ?= true\r\n    if script.clear\r\n      @chatbox.clear _run\r\n    else\r\n      _run()\r\n\r\n    return callback_holder"]}